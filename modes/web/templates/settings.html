<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Settings - {{name}}</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.5/dist/cdn.min.js"></script>
    <style>
        :root {
            --bg: #f5f5f0;
            --text: #1a1a1a;
            --border: #333;
            --muted: #666;
            --accent: #4a90d9;
        }
        /* Pastel Color Themes */
        [data-theme="cream"] {
            --bg: #f5f5f0;
            --text: #1a1a1a;
            --border: #333;
            --muted: #666;
            --accent: #4a90d9;
        }
        [data-theme="pink"] {
            --bg: #ffe4e9;
            --text: #4a1a28;
            --border: #d4758f;
            --muted: #8f5066;
            --accent: #ff6b9d;
        }
        [data-theme="mint"] {
            --bg: #e0f5f0;
            --text: #1a3a33;
            --border: #6eb5a3;
            --muted: #4d8073;
            --accent: #52d9a6;
        }
        [data-theme="lavender"] {
            --bg: #f0e9ff;
            --text: #2a1a4a;
            --border: #9d85d4;
            --muted: #6b5a8f;
            --accent: #a78bfa;
        }
        [data-theme="peach"] {
            --bg: #ffe9dc;
            --text: #4a2a1a;
            --border: #d49675;
            --muted: #8f6650;
            --accent: #ffab7a;
        }
        [data-theme="sky"] {
            --bg: #e0f0ff;
            --text: #1a2e4a;
            --border: #6ba3d4;
            --muted: #4d708f;
            --accent: #5eb3ff;
        }
        [data-theme="butter"] {
            --bg: #fff9e0;
            --text: #4a3f1a;
            --border: #d4c175;
            --muted: #8f8350;
            --accent: #ffd952;
        }
        [data-theme="rose"] {
            --bg: #fff0f3;
            --text: #4a1a2a;
            --border: #d47590;
            --muted: #8f5068;
            --accent: #ff9eb8;
        }
        [data-theme="sage"] {
            --bg: #eff5e9;
            --text: #2a331a;
            --border: #8fb575;
            --muted: #607a4d;
            --accent: #9bc978;
        }
        [data-theme="periwinkle"] {
            --bg: #e9f0ff;
            --text: #1a2a4a;
            --border: #758fd4;
            --muted: #50638f;
            --accent: #8ba3ff;
        }
        /* Dark Mode Themes */
        [data-theme="dark"] {
            --bg: #1a1a1a;
            --text: #e5e5e5;
            --border: #444;
            --muted: #888;
            --accent: #6ab0f3;
        }
        [data-theme="midnight"] {
            --bg: #0d1117;
            --text: #c9d1d9;
            --border: #30363d;
            --muted: #8b949e;
            --accent: #58a6ff;
        }
        [data-theme="charcoal"] {
            --bg: #2b2b2b;
            --text: #e8e6e3;
            --border: #555;
            --muted: #999;
            --accent: #ffa657;
        }
        [data-theme="ocean"] {
            --bg: #e0f2f7;
            --text: #0d3b47;
            --border: #4a9fb0;
            --muted: #2d6d7a;
            --accent: #00bcd4;
        }
        [data-theme="sunset"] {
            --bg: #ffe8d9;
            --text: #4a2818;
            --border: #d47942;
            --muted: #8f5a35;
            --accent: #ff6f3c;
        }
        [data-theme="forest"] {
            --bg: #e8f5e9;
            --text: #1b5e20;
            --border: #66bb6a;
            --muted: #388e3c;
            --accent: #4caf50;
        }
        [data-theme="noir"] {
            --bg: #f8f9fa;
            --text: #000;
            --border: #000;
            --muted: #495057;
            --accent: #000;
        }
        [data-theme="retro"] {
            --bg: #0d1b0d;
            --text: #33ff33;
            --border: #33ff33;
            --muted: #1a9919;
            --accent: #66ff66;
        }
        html { transition: background-color 0.5s ease, color 0.5s ease; }
        * { transition: border-color 0.3s ease, background-color 0.3s ease; }
        @media (prefers-color-scheme: dark) {
            :root {
                --bg: #1a1a1a;
                --text: #e5e5e0;
                --border: #555;
                --muted: #999;
                --accent: #6ab0f3;
            }
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Courier New', monospace;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding: 1rem;
        }
        header {
            padding: 1rem 0;
            border-bottom: 2px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        .header-left {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        .status-line,
        .thought-line {
            font-size: 0.75rem;
            color: var(--muted);
        }
        .thought-line {
            max-width: 60ch;
        }
        h1 { font-size: 1.5rem; }
        h2 {
            font-size: 1.125rem;
            margin: 2rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }
        .back-button {
            padding: 0.5rem 1rem;
            font-family: inherit;
            font-size: 1rem;
            background: transparent;
            color: var(--text);
            border: 2px solid var(--border);
            cursor: pointer;
        }
        .back-button:hover {
            background: var(--text);
            color: var(--bg);
        }
        .settings-section {
            max-width: 600px;
            margin: 0 auto;
        }
        .input-group {
            margin-bottom: 1.5rem;
        }
        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        .input-group input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            font-family: inherit;
            font-size: 1rem;
            border: 2px solid var(--border);
            background: var(--bg);
            color: var(--text);
        }
        .slider-container {
            margin-bottom: 1.5rem;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        .slider-label span:first-child {
            font-weight: bold;
        }
        .slider-value {
            color: var(--muted);
        }
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: var(--border);
            outline: none;
            -webkit-appearance: none;
        }
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--text);
            cursor: pointer;
        }
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--text);
            cursor: pointer;
            border: none;
        }
        .save-button {
            width: 100%;
            padding: 1rem;
            font-family: inherit;
            font-size: 1rem;
            background: var(--text);
            color: var(--bg);
            border: none;
            cursor: pointer;
            margin-top: 2rem;
        }
        .save-button:disabled {
            opacity: 0.5;
        }
        .message {
            padding: 1rem;
            margin-top: 1rem;
            border: 2px solid var(--accent);
            background: var(--bg);
            display: none;
        }
        .message.show {
            display: block;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                padding: 0.75rem;
            }
            header {
                padding: 0.75rem 0;
                margin-bottom: 1.5rem;
                flex-wrap: wrap;
                gap: 0.75rem;
            }
            h1 {
                font-size: 1.25rem;
            }
            h2 {
                font-size: 1rem;
                margin: 1.5rem 0 0.75rem;
            }
            .header-left {
                flex: 1 1 100%;
            }
            .status-line,
            .thought-line {
                font-size: 0.7rem;
            }
            .thought-line {
                max-width: 40ch;
            }
            header > div:last-child {
                width: 100%;
                justify-content: space-between !important;
            }
            .back-button {
                flex: 1;
                padding: 0.6rem 0.5rem;
                font-size: 0.85rem;
            }
            .settings-section {
                max-width: 100%;
            }
            .input-group {
                margin-bottom: 1.25rem;
            }
            .input-group input[type="text"],
            .input-group select {
                padding: 0.875rem;
                font-size: 16px !important; /* Prevents zoom on iOS */
            }
            .slider-container {
                margin-bottom: 1.25rem;
            }
            .slider::-webkit-slider-thumb {
                width: 24px;
                height: 24px; /* Larger for easier touch */
            }
            .slider::-moz-range-thumb {
                width: 24px;
                height: 24px;
            }
            .save-button {
                padding: 0.875rem;
                font-size: 16px;
                margin-top: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 0.5rem;
            }
            header {
                margin-bottom: 1rem;
            }
            h1 {
                font-size: 1.1rem;
            }
            h2 {
                font-size: 0.95rem;
                margin: 1rem 0 0.5rem;
            }
            .back-button {
                padding: 0.5rem 0.4rem;
                font-size: 0.75rem;
            }
            .input-group {
                margin-bottom: 1rem;
            }
            .slider-container {
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-left">
            <h1>
                <span class="face" id="face">{{face}}</span>
                <span>Settings</span>
            </h1>
            <div class="status-line" id="status">{{status}}</div>
            <div class="thought-line" id="thought">{{thought}}</div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
            <button class="back-button" onclick="location.href='/'">Chat</button>
            <button class="back-button" onclick="location.href='/tasks'">Tasks</button>
            <button class="back-button" onclick="location.href='/files'">Files</button>
        </div>
    </header>

    <div class="settings-section">
        <h2>üé® Appearance</h2>

        <div class="input-group">
            <label for="theme">Color Theme</label>
            <select id="theme" style="width: 100%; padding: 0.75rem; font-family: inherit; font-size: 1rem; border: 2px solid var(--border); background: var(--bg); color: var(--text);">
                <option value="cream">Cream (Default)</option>
                <option value="pink">Soft Pink</option>
                <option value="mint">Mint Green</option>
                <option value="lavender">Lavender</option>
                <option value="peach">Peach</option>
                <option value="sky">Sky Blue</option>
                <option value="butter">Butter Yellow</option>
                <option value="rose">Rose</option>
                <option value="sage">Sage</option>
                <option value="periwinkle">Periwinkle</option>
                <option value="dark">Dark Mode</option>
                <option value="midnight">Midnight Blue</option>
                <option value="charcoal">Charcoal</option>
                <option value="ocean">Ocean</option>
                <option value="sunset">Sunset</option>
                <option value="forest">Forest</option>
                <option value="noir">Noir</option>
                <option value="retro">Retro (CRT Green)</option>
            </select>
            <label style="display: flex; align-items: center; gap: 8px; margin-top: 8px; font-size: 0.875rem; cursor: pointer;">
                <input type="checkbox" id="theme-auto" style="width: 18px; height: 18px; cursor: pointer;">
                Auto day/night (cream by day, midnight at night)
            </label>
        </div>

        <h2>üñ•Ô∏è E-ink Display</h2>

        <div class="input-group">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="display-dark-mode" style="width: 18px; height: 18px; cursor: pointer;">
                <span>Dark Mode (Inverted display colors)</span>
            </label>
            <p style="font-size: 0.875rem; color: var(--muted); margin: 0.5rem 0 0 26px;">
                White-on-black display for nighttime viewing. Changes apply instantly via /darkmode command.
            </p>
        </div>

        <div class="input-group">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="screensaver-enabled" style="width: 18px; height: 18px; cursor: pointer;">
                <span>Screen Saver</span>
            </label>
            <p style="font-size: 0.875rem; color: var(--muted); margin: 0.5rem 0 0 26px;">
                Auto-activates after idle time. Cycles through stats, quotes, faces, and progression.
            </p>
        </div>

        <div class="input-group">
            <label for="screensaver-timeout">Screen Saver Idle Timeout (minutes)</label>
            <input type="number" id="screensaver-timeout" min="1" max="60" value="5" style="width: 100%; padding: 0.75rem; font-family: inherit; font-size: 1rem; border: 2px solid var(--border); background: var(--bg); color: var(--text);">
            <p style="font-size: 0.875rem; color: var(--muted); margin: 0.5rem 0 0 0;">
                Time before screen saver activates after last interaction.
            </p>
        </div>

        <h2>üë§ Device & Personality</h2>

        <div class="input-group">
            <label for="name">Name</label>
            <input type="text" id="name" value="{{name}}" maxlength="20">
        </div>

        <div class="slider-container">
            <div class="slider-label">
                <span>Curiosity</span>
                <span class="slider-value" id="curiosity-val">{{int(traits['curiosity'] * 100)}}%</span>
            </div>
            <input type="range" class="slider" id="curiosity" min="0" max="100" value="{{int(traits['curiosity'] * 100)}}" oninput="updateSlider('curiosity')">
        </div>

        <div class="slider-container">
            <div class="slider-label">
                <span>Cheerfulness</span>
                <span class="slider-value" id="cheerfulness-val">{{int(traits['cheerfulness'] * 100)}}%</span>
            </div>
            <input type="range" class="slider" id="cheerfulness" min="0" max="100" value="{{int(traits['cheerfulness'] * 100)}}" oninput="updateSlider('cheerfulness')">
        </div>

        <div class="slider-container">
            <div class="slider-label">
                <span>Verbosity</span>
                <span class="slider-value" id="verbosity-val">{{int(traits['verbosity'] * 100)}}%</span>
            </div>
            <input type="range" class="slider" id="verbosity" min="0" max="100" value="{{int(traits['verbosity'] * 100)}}" oninput="updateSlider('verbosity')">
        </div>

        <div class="slider-container">
            <div class="slider-label">
                <span>Playfulness</span>
                <span class="slider-value" id="playfulness-val">{{int(traits['playfulness'] * 100)}}%</span>
            </div>
            <input type="range" class="slider" id="playfulness" min="0" max="100" value="{{int(traits['playfulness'] * 100)}}" oninput="updateSlider('playfulness')">
        </div>

        <div class="slider-container">
            <div class="slider-label">
                <span>Empathy</span>
                <span class="slider-value" id="empathy-val">{{int(traits['empathy'] * 100)}}%</span>
            </div>
            <input type="range" class="slider" id="empathy" min="0" max="100" value="{{int(traits['empathy'] * 100)}}" oninput="updateSlider('empathy')">
        </div>

        <div class="slider-container">
            <div class="slider-label">
                <span>Independence</span>
                <span class="slider-value" id="independence-val">{{int(traits['independence'] * 100)}}%</span>
            </div>
            <input type="range" class="slider" id="independence" min="0" max="100" value="{{int(traits['independence'] * 100)}}" oninput="updateSlider('independence')">
        </div>

        <h2>ü§ñ AI Configuration <span style="font-size: 0.75rem; color: var(--muted); font-weight: normal;">(Requires Restart)</span></h2>

        <div class="input-group">
            <label for="ai-primary">Primary AI Provider</label>
            <select id="ai-primary" style="width: 100%; padding: 0.75rem; font-family: inherit; font-size: 1rem; border: 2px solid var(--border); background: var(--bg); color: var(--text);">
                <option value="anthropic">Anthropic (Claude)</option>
                <option value="openai">OpenAI (GPT)</option>
                <option value="gemini">Google (Gemini)</option>
                <option value="ollama">Ollama Cloud</option>
            </select>
        </div>

        <div class="input-group">
            <label for="anthropic-model">Anthropic Model</label>
            <select id="anthropic-model" style="width: 100%; padding: 0.75rem; font-family: inherit; font-size: 1rem; border: 2px solid var(--border); background: var(--bg); color: var(--text);">
                <option value="claude-haiku-4-5">Claude Haiku 4.5 (Fast & Cheap)</option>
                <option value="claude-sonnet-4-5">Claude Sonnet 4.5 (Balanced)</option>
                <option value="claude-opus-4-5">Claude Opus 4.5 (Most Capable)</option>
            </select>
        </div>

        <div class="input-group">
            <label for="openai-model">OpenAI Model</label>
            <select id="openai-model" style="width: 100%; padding: 0.75rem; font-family: inherit; font-size: 1rem; border: 2px solid var(--border); background: var(--bg); color: var(--text);">
                <option value="gpt-5-mini">GPT-5 Mini (Fast & Cheap)</option>
                <option value="gpt-5.2">GPT-5.2 (Most Capable)</option>
            </select>
        </div>

        <div class="input-group">
            <label for="gemini-model">Gemini Model</label>
            <select id="gemini-model" style="width: 100%; padding: 0.75rem; font-family: inherit; font-size: 1rem; border: 2px solid var(--border); background: var(--bg); color: var(--text);">
                <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
            </select>
        </div>

        <div class="input-group">
            <label for="ollama-model">Ollama Model</label>
            <select id="ollama-model" style="width: 100%; padding: 0.75rem; font-family: inherit; font-size: 1rem; border: 2px solid var(--border); background: var(--bg); color: var(--text);">
                <option value="qwen3-coder-next">Qwen3 Coder Next</option>
                <option value="kimi-k2.5">Kimi K2.5</option>
                <option value="ministral-3:8b-cloud">Ministral 3 8B</option>
                <option value="rnj-1:8b-cloud">RNJ-1 8B</option>
                <option value="nemotron-3-nano:30b-cloud">Nemotron 3 Nano 30B</option>
                <option value="gemini-3-flash-preview:cloud">Gemini 3 Flash Preview</option>
                <option value="glm-4.7:cloud">GLM 4.7</option>
                <option value="gpt-oss:120b-cloud">GPT-OSS 120B</option>
                <option value="gpt-oss:20b-cloud">GPT-OSS 20B</option>
            </select>
        </div>

        <div class="input-group">
            <label for="max-tokens">Max Tokens per Response</label>
            <input type="number" id="max-tokens" min="50" max="1000" step="50" style="width: 100%; padding: 0.75rem; font-family: inherit; font-size: 1rem; border: 2px solid var(--border); background: var(--bg); color: var(--text);">
            <p style="font-size: 0.875rem; color: var(--muted); margin-top: 0.25rem;">Lower = cheaper, faster. Higher = more detailed responses.</p>
        </div>

        <div class="input-group">
            <label for="daily-tokens">Daily Token Budget</label>
            <input type="number" id="daily-tokens" min="1000" max="50000" step="1000" style="width: 100%; padding: 0.75rem; font-family: inherit; font-size: 1rem; border: 2px solid var(--border); background: var(--bg); color: var(--text);">
            <p style="font-size: 0.875rem; color: var(--muted); margin-top: 0.25rem;">Maximum tokens per day (~$0.03 per 10,000 with Haiku)</p>
        </div>

        <p style="padding: 0.75rem; border: 2px solid var(--accent); background: var(--bg); font-size: 0.875rem; color: var(--muted); margin-top: 1rem;">
            ‚ö†Ô∏è <strong>Restart required:</strong> Changes to AI settings will take effect after restarting the application.
        </p>

        <button class="save-button" id="save-btn" onclick="saveSettings()">üíæ Save Settings</button>

        <div class="message" id="message"></div>
    </div>

    <script>
        // Load and apply saved theme
        const themeAutoEnabled = localStorage.getItem('inklingThemeAuto') === 'true';
        const savedTheme = localStorage.getItem('inklingTheme') || 'cream';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('theme').value = savedTheme;
        document.getElementById('theme-auto').checked = themeAutoEnabled;
        if (themeAutoEnabled) {
            document.getElementById('theme').disabled = true;
        }
        const statusEl = document.getElementById('status');
        const thoughtEl = document.getElementById('thought');

        // Theme change handler
        document.getElementById('theme').addEventListener('change', function() {
            const theme = this.value;
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('inklingTheme', theme);
        });

        // Auto-theme toggle
        document.getElementById('theme-auto').addEventListener('change', function() {
            const auto = this.checked;
            localStorage.setItem('inklingThemeAuto', auto ? 'true' : 'false');
            document.getElementById('theme').disabled = auto;
            if (auto) {
                const hour = new Date().getHours();
                const autoTheme = (hour >= 20 || hour < 7) ? 'midnight' : 'cream';
                document.documentElement.setAttribute('data-theme', autoTheme);
                localStorage.setItem('inklingTheme', autoTheme);
                document.getElementById('theme').value = autoTheme;
            }
        });

        function updateHeader() {
            fetch('/api/state')
                .then(r => r.json())
                .then(data => {
                    if (statusEl) statusEl.textContent = data.status || '';
                    if (thoughtEl) thoughtEl.textContent = data.thought || '';
                })
                .catch(() => {});
        }

        updateHeader();
        setInterval(updateHeader, 5000);

        // Load current AI settings on page load
        fetch('/api/settings')
            .then(resp => resp.json())
            .then(data => {
                if (data.ai) {
                    document.getElementById('ai-primary').value = data.ai.primary || 'anthropic';
                    document.getElementById('anthropic-model').value = data.ai.anthropic?.model || 'claude-3-haiku-20240307';
                    document.getElementById('openai-model').value = data.ai.openai?.model || 'gpt-4o-mini';
                    document.getElementById('gemini-model').value = data.ai.gemini?.model || 'gemini-2.0-flash-exp';
                    document.getElementById('ollama-model').value = data.ai.ollama?.model || 'qwen3-coder-next';
                    document.getElementById('max-tokens').value = data.ai.budget?.max_tokens || 150;
                    document.getElementById('daily-tokens').value = data.ai.budget?.daily_tokens || 10000;
                }
                if (data.display) {
                    document.getElementById('display-dark-mode').checked = data.display.dark_mode || false;
                    document.getElementById('screensaver-enabled').checked = data.display.screensaver?.enabled || false;
                    document.getElementById('screensaver-timeout').value = data.display.screensaver?.idle_timeout_minutes || 5;
                }
            })
            .catch(err => console.error('Failed to load settings:', err));

        function updateSlider(name) {
            const slider = document.getElementById(name);
            const display = document.getElementById(name + '-val');
            display.textContent = slider.value + '%';
        }

        async function saveSettings() {
            const saveBtn = document.getElementById('save-btn');
            const messageEl = document.getElementById('message');

            saveBtn.disabled = true;
            messageEl.classList.remove('show');

            const settings = {
                name: document.getElementById('name').value.trim(),
                traits: {
                    curiosity: parseFloat(document.getElementById('curiosity').value) / 100,
                    cheerfulness: parseFloat(document.getElementById('cheerfulness').value) / 100,
                    verbosity: parseFloat(document.getElementById('verbosity').value) / 100,
                    playfulness: parseFloat(document.getElementById('playfulness').value) / 100,
                    empathy: parseFloat(document.getElementById('empathy').value) / 100,
                    independence: parseFloat(document.getElementById('independence').value) / 100,
                },
                display: {
                    dark_mode: document.getElementById('display-dark-mode').checked,
                    screensaver: {
                        enabled: document.getElementById('screensaver-enabled').checked,
                        idle_timeout_minutes: parseInt(document.getElementById('screensaver-timeout').value),
                    }
                },
                ai: {
                    primary: document.getElementById('ai-primary').value,
                    anthropic: {
                        model: document.getElementById('anthropic-model').value,
                    },
                    openai: {
                        model: document.getElementById('openai-model').value,
                    },
                    gemini: {
                        model: document.getElementById('gemini-model').value,
                    },
                    ollama: {
                        model: document.getElementById('ollama-model').value,
                    },
                    budget: {
                        daily_tokens: parseInt(document.getElementById('daily-tokens').value),
                        per_request_max: parseInt(document.getElementById('max-tokens').value),
                    }
                }
            };

            // Validate name
            if (!settings.name || settings.name.length === 0) {
                messageEl.textContent = 'Error: Name cannot be empty';
                messageEl.classList.add('show');
                saveBtn.disabled = false;
                return;
            }

            try {
                const resp = await fetch('/api/settings', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(settings)
                });

                const data = await resp.json();

                if (resp.ok && data.success) {
                    messageEl.textContent = '‚úì Settings saved! Personality changes applied. Restart to apply AI changes.';
                    messageEl.classList.add('show');
                } else {
                    messageEl.textContent = 'Error: ' + (data.error || 'Failed to save settings');
                    messageEl.classList.add('show');
                }
            } catch (e) {
                messageEl.textContent = 'Connection error: ' + e.message;
                messageEl.classList.add('show');
            }

            saveBtn.disabled = false;
        }
    </script>
</body>
</html>

